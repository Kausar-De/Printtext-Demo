{% extends 'printtextpage/base.html' %}
{% block content %}
{% load static %}
{% load crispy_forms_tags %}
{% include 'printtextpage/navigation.html' %}

<br>

<div class="col">
  <p style="text-align: center; font-family: 'Ubuntu', sans-serif; font-size: 65px; font-weight: bold; line-height: 110px;">Print Order Form</p>
</div>

<div class="col" style="text-align: center;">
  <div class="container-fluid" style="font-family: 'Ubuntu', sans-serif; font-size: 20px;">
    <form method="POST" action ="" enctype="multipart/form-data">
      {% csrf_token %}
      <ul id="formtabs" class="nav nav-tabs">
          <li class="nav-item" id="menu0proceed"><a class="nav-link active" data-toggle="tab" href="#fileupload">Upload File</a></li>
          <li class="nav-item" id="menu1proceed"><a class="nav-link" data-toggle="tab" href="#options">Print Options</a></li>
          <li class="nav-item" id="menu2proceed"><a class="nav-link" data-toggle="tab" href="#address">Delivery Address</a></li>
          <li class="nav-item" id="menu3proceed"><a class="nav-link" data-toggle="tab" href="#review">Review Order</a></li>
      </ul>
      <div class="tab-content">
        <div id="fileupload" class="tab-pane active">
          <table class="table align-middle">
            <tbody>
              <tr>
                <th scope="row">Upload or Drop Document (Max 25MB)*</th>
                <td>{{ form.docupload|as_crispy_field }}</td>
              </tr>
            </tbody>
          </table>
          <table>
            <tbody>
              <tr>
                <button class="btn btn-info" id="tab1proceed">Proceed</button>
              </tr>
            </tbody>
          </table>
          <div class="row">
            <div class="col">
              {% for message in messages %}
                <p style="color: darkred;">{{message}}</p>
              {% endfor %}
            </div>
          </div>
        </div>
        <div id="options" class="tab-pane fade">
          <div class="row">
            <div class="col">        
              <table class="table align-middle">
                <tbody>
                  <tr>
                    <th scope="row">Name*</th>
                    <td>{{ form.name|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Mobile No. (WhatsApp No.)*</th>
                    <td>{{ form.mobno|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Print Colour*</th>
                    <td>{{ form.printcolour|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Page Type*</th>
                    <td>{{ form.pagetype|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Number of Copies*</th>
                    <td>{{ form.copies|as_crispy_field }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col">        
              <table class="table align-middle">
                <tbody>
                  <tr>
                    <th scope="row">Email ID*</th>
                    <td>{{ form.email|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Cover Option*</th>
                    <td>{{ form.coveroption|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Binding Option*</th>
                    <td>{{ form.bindingoption|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Page Count (For Non - PDF Files)</th>
                    <td>{{ form.pagecount|as_crispy_field }}</td>
                  </tr>
                  <tr>
                    <th scope="row">Extra Comments</th>
                    <td>{{ form.extracomment|as_crispy_field }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <table>
                <tbody>
                  <tr>
                    <button class="btn btn-info" id="tab2proceed">Proceed</button>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="address" class="tab-pane fade">
          <table class="table align-middle">
            <tbody>
              <tr>
                <th scope="row">Full Address & PIN Code*</th>
                <td>{{ form.address|as_crispy_field }}</td>
              </tr>
            </tbody>
          </table>
          <table>
            <tbody>
              <tr>
                <button class="btn btn-info" id="tab3proceed">Proceed</button>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="review" class="tab-pane fade">
          <div class="row">
            <div class="col"> 
              <table class="table align-middle" style="margin-bottom: 0;">
                <tbody>
                  <tr>
                    <th scope="row">Name</th>
                    <td id="review_name"></td>
                  </tr>
                  <tr>
                    <th scope="row">Mobile No. (WhatsApp No.)</th>
                    <td id="review_mobno"></td>
                  </tr>
                  <tr>
                    <th scope="row">Print Colour</th>
                    <td id="review_printcolour"></td>
                  </tr>
                  <tr>
                    <th scope="row">Page Type</th>
                    <td id="review_pagetype"></td>
                  </tr>
                  <tr>
                    <th scope="row">Document</th>
                    <td id="review_docupload"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col">        
              <table class="table align-middle" style="margin-bottom: 0;">
                <tbody>
                  <tr>
                    <th scope="row">Email ID</th>
                    <td id="review_email"></td>
                  </tr>
                  <tr>
                    <th scope="row">Cover Option</th>
                    <td id="review_coveroption"></td>
                  </tr>
                  <tr>
                    <th scope="row">Binding Option</th>
                    <td id="review_bindingoption"></td>
                  </tr>
                  <tr>
                    <th scope="row">Page Count (For Non - PDF Files)</th>
                    <td id="review_pagecount"></td>
                  </tr>
                  <tr>
                    <th scope="row">Extra Comments</th>
                    <td id="review_extracomment"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="row">
            <table class="table align-middle" style="margin-bottom: 0;">
              <tbody>
                <tr>
                  <th scope="row">Number of Copies: <span id="review_copies"></span></th>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row">
            <table class="table align-middle">
              <tbody>
                <tr>
                  <th scope="row">Estimated Price (Rupees)(Additional Delivery Charge Will Be Applied): <span id="price_estimate" style="color: green;"></span></th>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row">
            <div class="col">
              <button class="btn btn-info" type="button" onclick="generateEstimate()">Get Cost Estimate</button>
              <button class="btn btn-success" type="submit" value="Submit">Place Order</button>
            </div>
            {% for message in messages %}
              <p style="color: darkred;">{{message}}</p>
            {% endfor %}
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<br>

<script>
$(document).ready(function(){
  $(".nav-tabs a").click(function(){
    $(this).tab('show');
  });
});

$('#tab1proceed').click(function(e){
  e.preventDefault();
  $('#formtabs a[href="#options"]').tab('show');
})

$('#tab2proceed').click(function(e){
  e.preventDefault();
  $('#formtabs a[href="#address"]').tab('show');
})

$('#tab3proceed').click(function(e){
  if (!$("#id_name").val() || !$("#id_mobno").val() || !$("#id_printcolour").val() || !$("#id_pagetype").val() || !$("#id_docupload").val().split('\\').pop() || !$("#id_email").val() || !$("#id_coveroption").val() || !$("#id_bindingoption").val()){
    alert("Please fill all the required fields!");
  }
  else {
    e.preventDefault();
    $('#formtabs a[href="#review"]').tab('show');
    document.getElementById("review_name").innerHTML =  $("#id_name").val();
    document.getElementById("review_mobno").innerHTML =  $("#id_mobno").val();
    document.getElementById("review_printcolour").innerHTML =  $("#id_printcolour").val();
    document.getElementById("review_pagetype").innerHTML =  $("#id_pagetype").val();
    document.getElementById("review_docupload").innerHTML =  $("#id_docupload").val().split('\\').pop();
    document.getElementById("review_email").innerHTML =  $("#id_email").val();
    document.getElementById("review_coveroption").innerHTML =  $("#id_coveroption").val();
    document.getElementById("review_bindingoption").innerHTML =  $("#id_bindingoption").val();
    document.getElementById("review_extracomment").innerHTML =  $("#id_extracomment").val();
    document.getElementById("review_copies").innerHTML =  $("#id_copies").val();
    
    var pagecounter =  $("#id_docupload").val().split('\\').pop();
    var pdfcheck = pagecounter.includes(".pdf", -4);
    if (pdfcheck == true) {
      var input = document.getElementById("id_docupload");
      var reader = new FileReader();
      reader.readAsBinaryString(input.files[0]);
      reader.onloadend = function(){
        var count = reader.result.match(/\/Type[\s]*\/Page[^s]/g).length;
        document.getElementById("review_pagecount").innerHTML = count;
      }
    }
    else {
      document.getElementById("review_pagecount").innerHTML = $("#id_pagecount").val();
    }
  }
})

$('#menu3proceed').click(function(e){
  if (!$("#id_name").val() || !$("#id_mobno").val() || !$("#id_printcolour").val() || !$("#id_pagetype").val() || !$("#id_docupload").val().split('\\').pop() || !$("#id_email").val() || !$("#id_coveroption").val() || !$("#id_bindingoption").val()){
    alert("Please fill all the required fields!");
  }
  else {
    e.preventDefault();
    $('#formtabs a[href="#review"]').tab('show');
    document.getElementById("review_name").innerHTML =  $("#id_name").val();
    document.getElementById("review_mobno").innerHTML =  $("#id_mobno").val();
    document.getElementById("review_printcolour").innerHTML =  $("#id_printcolour").val();
    document.getElementById("review_pagetype").innerHTML =  $("#id_pagetype").val();
    document.getElementById("review_docupload").innerHTML =  $("#id_docupload").val().split('\\').pop();
    document.getElementById("review_email").innerHTML =  $("#id_email").val();
    document.getElementById("review_coveroption").innerHTML =  $("#id_coveroption").val();
    document.getElementById("review_bindingoption").innerHTML =  $("#id_bindingoption").val();
    document.getElementById("review_extracomment").innerHTML =  $("#id_extracomment").val();
    document.getElementById("review_copies").innerHTML =  $("#id_copies").val();
    
    var pagecounter =  $("#id_docupload").val().split('\\').pop();
    var pdfcheck = pagecounter.includes(".pdf", -4);
    if (pdfcheck == true) {
      var input = document.getElementById("id_docupload");
      var reader = new FileReader();
      reader.readAsBinaryString(input.files[0]);
      reader.onloadend = function(){
        var count = reader.result.match(/\/Type[\s]*\/Page[^s]/g).length;
        document.getElementById("review_pagecount").innerHTML = count;
      }
    }
    else {
      document.getElementById("review_pagecount").innerHTML = $("#id_pagecount").val();
    }
  }
})

function generateEstimate(){
  var price = document.getElementById("review_pagecount").innerText;
  
  if ($("#id_printcolour").val() == "Full Colour") {
    price = price * 5;
  } 
  else if ($("#id_printcolour").val() == "Black & White") {
    price = price * 2;
  }

  if ($("#id_pagetype").val() == "Normal Paper (70GSM)") {
    price = price * 1;
  }
  else if ($("#id_pagetype").val() == "Normal Paper (75GSM)") {
    price = price * 2;
  }
  else if ($("#id_pagetype").val() == "Bond Paper (80GSM)") {
    price = price * 3.5;
  }
  else if ($("#id_pagetype").val() == "Glossy Paper (180GSM)") {
    price = price * 18;
  }

  if ($("#id_coveroption").val() == "Thick Colored Cover") {
    price = price + 4;
  }
  else if ($("#id_coveroption").val() == "Cover with Design") {
    price = price + 10;
  }

  if ($("#id_bindingoption").val() == "Spiral Bind") {
    price = price + 60;
  }

  price = price * $("#id_copies").val();

  document.getElementById("price_estimate").innerHTML = price;
}

</script>

{% endblock %}